var $event=$.event,$special,resizeTimeout;$special=$event.special.debouncedresize={setup:function(){$(this).on("resize",$special.handler)},teardown:function(){$(this).off("resize",$special.handler)},handler:function(e,i){var t=this,a=arguments,s=function(){e.type="debouncedresize",$event.dispatch.apply(t,a)};resizeTimeout&&clearTimeout(resizeTimeout),i?s():resizeTimeout=setTimeout(s,$special.threshold)},threshold:250};var BLANK="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";$.fn.imagesLoaded=function(e){function i(){var i=$(l),t=$(d);s&&(d.length?s.reject(r,i,t):s.resolve(r)),$.isFunction(e)&&e.call(a,r,i,t)}function t(e,t){e.src!==BLANK&&-1===$.inArray(e,o)&&(o.push(e),t?d.push(e):l.push(e),$.data(e,"imagesLoaded",{isBroken:t,src:e.src}),n&&s.notifyWith($(e),[t,r,$(l),$(d)]),r.length===o.length&&(setTimeout(i),r.unbind(".imagesLoaded")))}var a=this,s=$.isFunction($.Deferred)?$.Deferred():0,n=$.isFunction(s.notify),r=a.find("img").add(a.filter("img")),o=[],l=[],d=[];return $.isPlainObject(e)&&$.each(e,function(i,t){"callback"===i?e=t:s&&s[i](t)}),r.length?r.bind("load.imagesLoaded error.imagesLoaded",function(e){t(e.target,"error"===e.type)}).each(function(e,i){var a=i.src,s=$.data(i,"imagesLoaded");return s&&s.src===a?void t(i,s.isBroken):i.complete&&void 0!==i.naturalWidth?void t(i,0===i.naturalWidth||0===i.naturalHeight):void((i.readyState||i.complete)&&(i.src=BLANK,i.src=a))}):i(),s?s.promise(a):a},$(function(){$.elastic_grid={version:"1.0"},$.fn.elastic_grid=function(e){function i(e,i){e.each(function(e,t){classie.has(t,i)?(classie.toggle(t,"animate"),classie.remove(t,"hidden")):(classie.add(t,"hidden"),classie.remove(t,"animate"))})}function t(e){var i=e.toLowerCase().replace(" ","-");if(""!=e){{var t=$("<li>");$("<a>",{html:e,"data-filter":"."+i,href:"#","class":"filter"}).appendTo(t)}t.appendTo(u)}}function a(e){T.each(function(){var i=$(this);i.data("offsetTop",i.offset().top),e&&i.data("height",i.height())})}function s(){n(T),C.on("debouncedresize",function(){O=0,A=-1,a(),r();var e=$.data(this,"preview");"undefined"!=typeof e&&l()})}function n(e){e.on("click","span.og-close",function(){return l(),!1}).children("a").on("click",function(e){var i=$(this).parent();return i.removeClass("animate"),x===i.index()?l($(this)):o(i),!1})}function r(){w={width:C.width(),height:C.height()}}function o(e){l();var i=$.data(this,"preview"),t=e.data("offsetTop");if(O=0,"undefined"!=typeof i){if(A===t)return i.update(e),!1;t>A&&(O=i.height),l()}A=t,i=$.data(this,"preview",new d(e)),i.open()}function l(){T.find(".og-pointer").remove();var e=$(".og-expanded").data("id"),i='[data-return$="'+e+'"]';x=-1;var t=$.data(this,"preview");if("undefined"==typeof t||t.close(),$.removeData(this,"preview"),$(i)[0]){var a=$(i)[0].getBoundingClientRect();window.scrollTo(a.left+window.scrollX+a.width,a.top+window.scrollY),$(i).removeAttr("data-return")}}function d(e){this.$item=e,this.expandedIdx=this.$item.index(),this.create(),this.update()}e=$.extend({},{items:null,filterEffect:"",hoverDirection:!0,hoverDelay:0,hoverInverse:!1,expandingHeight:500,expandingSpeed:300,callback:function(){}},e);var h=$(this),c=e.items.length;if(0==c)return!1;h.html('<div class="wagwep-container"><nav id="porfolio-nav" class="clearfix"><ul id="portfolio-filter" class="nav nav-tabs clearfix"></ul></nav></div>');var g=$('<ul id="og-grid" class="og-grid"></ul>');for(itemIdx=0;itemIdx<c;itemIdx++)if(void 0!=e.items[itemIdx]){var f=e.items[itemIdx];liObject=$("<li></li>"),tags=f.tags,strTag="";for(var p=tags.length-1;p>=0;p--)strTag+=","+tags[p];strTag=strTag.substring(1),liObject.attr("data-tags",strTag),aObject=$("<a></a>"),aObject.attr("href","javascript:;;"),imgObject=$("<img/>"),imgObject.attr("src",f.thumbnail[0]),imgObject.attr("data-largesrc",f.large[0]),spanObject=$("<span></span>"),spanObject.html(f.title),figureObject=$("<figure></figure>"),figureObject.append(spanObject),imgObject.appendTo(aObject),figureObject.appendTo(aObject),aObject.appendTo(liObject),liObject.appendTo(g)}""==e.filterEffect&&(e.filterEffect="moveup"),g.addClass("effect-"+e.filterEffect),g.appendTo(h),1==e.hoverDirection&&g.find("li").each(function(){$(this).hoverdir({hoverDelay:e.hoverDelay,inverse:e.hoverInverse})});var u=h.find("#portfolio-filter"),m=g.find("li"),v={};numOfTag=0,m.each(function(e){var i=$(this),t=i.data("tags").split(",");i.attr("data-id",e),i.addClass("all"),$.each(t,function(e,t){t=$.trim(t),i.addClass(t.toLowerCase().replace(" ","-")),t in v||(v[t]=[],numOfTag++),v[t].push(i)})}),numOfTag>1?(t(e.showAllText),$.each(v,function(e,i){t(e)})):u.remove(),u.find("a").bind("click",function(e){b.find("li.og-expanded").find("a").trigger("click"),b.find(".og-close").trigger("click"),$this=$(this),$this.css("outline","none"),u.find(".current").removeClass("current"),$this.parent().addClass("current");var t=$this.text().toLowerCase().replace(" ","-"),a=c;return g.find("li").each(function(e,s){classie.remove(s,"hidden"),classie.remove(s,"animate"),--a||setTimeout(function(){i(g.find("li"),t)},1)}),!1}),u.find("li:first").addClass("current");var w,b=g,T=b.children("li"),x=-1,A=-1,O=0,j=10,C=$(window),L=$("html, body"),y={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},I=y[Modernizr.prefixed("transition")],E=Modernizr.csstransitions,k={minHeight:e.expandingHeight,speed:e.expandingSpeed,easing:"ease"};d.prototype={create:function(){this.$title=$("<h3></h3>"),this.$description=$("<p></p>"),this.$href=$('<a href="#">Visit website</a>'),this.$detailButtonList=$('<span class="buttons-list"></span>'),this.$details=$('<div class="og-details"></div>').append(this.$title,this.$description,this.$detailButtonList),this.$loading=$('<div class="og-loading"></div>'),this.$fullimage=$('<div class="og-fullimg"></div>').append(this.$loading),this.$closePreview=$('<span class="og-close"></span>'),this.$previewInner=$('<div class="og-expander-inner"></div>').append(this.$closePreview,this.$fullimage,this.$details),this.$previewEl=$('<div class="og-expander"></div>').append(this.$previewInner),this.$item.append($('<div class="og-pointer"></div>')),this.$item.append(this.getEl()),E&&this.setTransition()},update:function(i){if(i&&(this.$item=i),-1!==x){var t=T.eq(x);t.removeClass("og-expanded"),this.$item.addClass("og-expanded"),this.positionPreview()}if(x=this.$item.index(),"undefined"==typeof e.items[x]);else{if(eldata=e.items[x],this.$title.html(eldata.title),this.$description.html(eldata.description),this.$detailButtonList.html(""),urlList=eldata.button_list,urlList.length>0)for(p=0;p<urlList.length;p++){var a=urlList[p].new_window?"_blank":"_self",s=$('<a target="'+a+'"></a>');s.addClass("link-button"),0==p&&s.addClass("first"),s.attr("href",urlList[p].url),s.html(urlList[p].title),this.$detailButtonList.append(s)}var n=this;if("undefined"!=typeof n.$largeImg&&n.$largeImg.remove(),glarge=eldata.large,gthumbs=eldata.thumbnail,glarge.length==gthumbs.length&&glarge.length>0){var r=$("<ul></ul>");for(p=0;p<gthumbs.length;p++){var o=$("<li></li>"),s=$('<a href="javascript:;;"></a>'),l=$("<img/>");l.addClass("related_photo"),0==p&&l.addClass("selected"),l.attr("src",gthumbs[p]),l.attr("data-large",glarge[p]),s.append(l),o.append(s),r.append(o)}r.addClass("elastislide-list"),r.elastislide();var d=$('<div class="elastislide-wrapper elastislide-horizontal"></div>');d.append(r).find(".related_photo").bind("click",function(){d.find(".selected").removeClass("selected"),$(this).addClass("selected"),$largePhoto=$(this).data("large"),$("<img/>").load(function(){n.$fullimage.find("img").fadeOut(500,function(){$(this).fadeIn(500).attr("src",$largePhoto)})}).attr("src",$largePhoto)}),n.$details.append('<div class="infosep"></div>'),n.$details.append(d)}else n.$details.find(".infosep, .og-grid-small").remove();n.$fullimage.is(":visible")&&(this.$loading.show(),$("<img/>").load(function(){var e=$(this);e.attr("src")===n.$item.children("a").find("img").data("largesrc")&&(n.$loading.hide(),n.$fullimage.find("img").remove(),n.$largeImg=e.fadeIn(350),n.$fullimage.append(n.$largeImg))}).attr("src",eldata.large[0]))}},open:function(){function e(){n.scrollTop(a)}function i(){a=n.scrollTop(),n.on("scroll",e)}function t(){n.off("scroll",e)}setTimeout($.proxy(function(){this.setHeights(),this.positionPreview()},this),25);var a,s=$(".og-fullimg"),n=$(document);s.on("mouseenter",function(){s[0].scrollHeight>s.height()?i():t()}),s.on("mouseleave",function(){t()})},close:function(){var e=this,i=function(){E&&$(this).off(I),e.$item.removeClass("og-expanded"),e.$previewEl.remove()};return setTimeout($.proxy(function(){"undefined"!=typeof this.$largeImg&&this.$largeImg.fadeOut("fast"),this.$previewEl.css("height",0);var e=T.eq(this.expandedIdx);e.css("height",e.data("height")).on(I,i),E||i.call()},this),25),!1},calcHeight:function(){var e=w.height-this.$item.data("height")-j,i=w.height;e<k.minHeight&&(e=k.minHeight,i=k.minHeight+this.$item.data("height")+j),this.height=e,this.itemHeight=i},setHeights:function(){var e=this,i=function(){E&&e.$item.off(I),e.$item.addClass("og-expanded")};this.calcHeight(),this.$previewEl.css("height",this.height),this.$item.css("height",this.itemHeight).on(I,i),E||i.call()},positionPreview:function(){var e=this.$item.data("offsetTop"),i=this.$previewEl.offset().top-O,t=this.height+this.$item.data("height")+j<=w.height?e:this.height<w.height?i-(w.height-this.height):i;L.animate({scrollTop:t},k.speed)},setTransition:function(){this.$previewEl.css("transition","height "+k.speed+"ms "+k.easing),this.$item.css("transition","height "+k.speed+"ms "+k.easing)},getEl:function(){return this.$previewEl}},b.imagesLoaded(function(){a(!0),r(),s()})}});